{{#if (or (and isCarto configWithTemplate.isSuccessful) (not isCarto))}}
  {{#if (and config visible)}}
    {{#map.source
      sourceId=config.id
      options=sourceOptions as |source|}}
      {{#each config.layers as |layerConfig|}}
        {{source.layer
          layer=layerConfig.layer
          before=layerConfig.before}}
      {{/each}}
    {{/map.source}}
  {{/if}}
{{/if}}

<li class='layer-group clearfix'>
  {{layer-menu-item
      title=config.title
      config=group
      visible=visible
      click=(action 'toggleVisibility')}}
  {{if configWithTemplate.isPending '(Loading)'}}
  {{#if visible}}
    <ul class="no-bullet">
      {{#each config.filters as |filter|}}
        {{#each filter.values as |value|}}
          <li>{{value.label}}</li>
        {{/each}}
      {{/each}}
    </ul>
  {{/if}}
</li>

{{yield 
  (hash 
    timeline-control=
      (component 'layer-control-timeline' layer=
        (hash 
          visible=visible
        )
        qps=qps
      )
    multi-select-control=
      (component 'layer-multi-select-control' layer=
        (hash 
          visible=visible
        )
        qps=qps
      )
    visible=visible
    updateSql=(action 'updateSql')
  )
}}
