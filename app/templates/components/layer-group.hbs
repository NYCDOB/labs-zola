{{#if (or (and isCarto configWithTemplate.isSuccessful) (not isCarto))}}
  {{#if (and config visible)}}
    {{#map.source
      sourceId=config.id
      options=sourceOptions as |source|}}
      {{#each config.layers as |layerConfig|}}
        {{source.layer
          layer=layerConfig.layer
          before=layerConfig.before}}
      {{/each}}
    {{/map.source}}
  {{/if}}
{{/if}}

{{#unless hasBlock}}
  {{layer-menu-item
    title=config.title
    config=group
    visible=visible
    click=(action 'toggleVisibility')}}
{{/unless}}

{{yield 
  (hash 
    timeline-control=
      (component 'layer-control-timeline' layer=
        (hash 
          visible=visible
        )
        qps=qps
      )
    multi-select-control=
      (component 'layer-multi-select-control' layer=
        (hash 
          visible=visible
        )
        qps=qps
      )
    tooltip=
      (component 'layer-tooltip' layer=
        (hash
          visible=visible
        )
      )
    visible=visible
    updateSql=(action 'updateSql')
    isPending=configWithTemplate.isPending
    toggleVisibility=(action 'toggleVisibility')
  )
}}
