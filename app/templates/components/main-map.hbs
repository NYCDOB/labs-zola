{{map-search transitionTo=transitionTo}}

{{#mapbox-gl
  id='main-map'
  initOptions=(hash style='mapbox://styles/mapbox/light-v9'
                    zoom=zoom
                    center=(array lng lat))
  mapLoaded=(action 'handleMapLoad')
  as |map|}}  

  {{map.interactive-layers config=config}}

  {{#if highlightedLotFeatures}}
    {{#map.source 
      sourceId='highlighted-lot' 
      options=highlightedLotSource as |source|}}
      {{source.layer 
        layer=highlightedLotLayer 
        before='waterway-label'}}
    {{/map.source}}
  {{/if}}

  {{#if mainMap.selected}}
    {{#map.source 
      sourceId='selected-lot' 
      options=selectedLotSource as |source|}}
      {{source.layer 
        layer=selectedLotLayer 
        after='waterway-label'}}
    {{/map.source}}
  {{/if}}

  {{map.call 'fitBounds' mainMap.bounds}}
  {{map.on 'click' (action routeToLot)}}
  {{map.on 'mousemove' (action 'handleMouseover')}}
  {{map.on 'mouseout' (action 'handleMouseleave')}}

{{/mapbox-gl}}
